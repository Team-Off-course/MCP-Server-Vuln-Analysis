# CVE-2025-66689

## Summary

A path traversal vulnerability in Pal MCP Server's file reading functionality allows users to read arbitrary files on the system. ( < 9.8.2v)

The insufficient path validation in `is_dangerous_path()` can be bypassed by accessing subdirectories of blacklisted paths.

> This vulnerability has been fixed in **version 9.8.2** of Pal MCP Server.

---

## Details

### Vulnerable Code Location

**File**: `utils/security_config.py`

```python
DANGEROUS_PATHS = {
    "/",
    "/etc",
    "/usr",
    "C:\\\\",
    "C:\\\\Windows",      # Only blocks C:\\Windows itself
    "C:\\\\Program Files",
    "C:\\\\Users",
}

def is_dangerous_path(path: Path) -> bool:
    try:
        resolved = path.resolve()
        # ❌ Only checks exact string match - subdirectories are not blocked
        return str(resolved) in DANGEROUS_PATHS or resolved.parent == resolved
    except Exception:
        return True

```

**File**: `utils/file_utils.py` → `resolve_and_validate_path()`

This function calls `is_dangerous_path()` but the validation is insufficient:

```python
def resolve_and_validate_path(path_str: str) -> Path:
    user_path = Path(path_str)

    if not user_path.is_absolute():
        raise ValueError("Relative paths are not supported...")

    resolved_path = user_path.resolve()

    # ❌ Blacklist-based approach with exact match only
    if is_dangerous_path(resolved_path):
        raise PermissionError(f"Access to system directory denied: {path_str}")

    return resolved_path

```

### Root Cause

1. **Exact String Matching**: `"C:\\\\Windows"` blocks `C:\\Windows` but not `C:\\Windows\\System32\\drivers\\etc\\`
2. **Blacklist Approach**: Cannot anticipate all dangerous paths
3. **No Subdirectory Check**: Missing logic to verify if path is under a dangerous directory

### Attack Flow

```
User Input (chat tool)
    ↓
SimpleTool.execute()
    ↓
prepare_prompt() → read_files()
    ↓
read_file_content()
    ↓
resolve_and_validate_path()  ← Vulnerable function
    ↓
is_dangerous_path()          ← Bypassed!
    ↓
open(file, 'r')              ← Arbitrary file read

```

---

## PoC

<img width="1018" height="532" alt="Image" src="img\image5.png" />

<img width="2384" height="1455" alt="Image" src="img\image6.png" />

**Result**: Successfully reads the hosts file, bypassing `C:\\Windows` blacklist check.

---



## Who is Impacted?

- All Pal MCP Server users running versions prior to 9.8.2 who have tools that accept file path inputs enabled

<br>

---

<br>

---

## Patch Information

This vulnerability has been fixed in **version 9.8.2** of Pal MCP Server. Users are strongly advised to upgrade to this version or later.

- https://github.com/BeehiveInnovations/pal-mcp-server/pull/353/files#diff-ddd278acabc8a816c9be4ed1a2aabb3ec8943f69217911d9ccbdb19d3b12b25c

---

## References

- https://cwe.mitre.org/data/definitions/22.html
- https://cwe.mitre.org/data/definitions/552.html

**reported by:** Team off-course (K-Shield.Jr 15th )